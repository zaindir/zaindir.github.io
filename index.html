<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Java Game Archive</title>
<style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f4f4f4; }
    #pagination a { margin: 0 3px; text-decoration: none; color: blue; cursor: pointer; }
    #pagination a:hover { text-decoration: underline; }
</style>
</head>
<body>

<h1>Java Game Archive</h1>

<!-- SEARCH -->
<form onsubmit="return false;">
Search:
<input type="text" id="search" onkeyup="applySearch()">
</form>

<br>

<table>
<thead>
<tr>
<th>Nama Game</th>
<th>Ukuran</th>
<th>Download</th>
</tr>
</thead>
<tbody id="data"></tbody>
</table>

<br>

<div id="pagination"></div>

<script>
const perPage = 20;
let currentPage = 1;
let rows = [];
let filteredRows = [];

/* CSV parser aman (quote, koma, CRLF) */
function parseCSV(text) {
    const result = [];
    let row = [];
    let value = '';
    let inQuotes = false;

    for (let i = 0; i < text.length; i++) {
        const c = text[i];

        if (c === '"') {
            inQuotes = !inQuotes;
        } else if (c === ',' && !inQuotes) {
            row.push(value);
            value = '';
        } else if ((c === '\n' || c === '\r') && !inQuotes) {
            if (value !== '' || row.length > 0) {
                row.push(value);
                result.push(row);
                row = [];
                value = '';
            }
        } else {
            value += c;
        }
    }
    if (value !== '' || row.length > 0) result.push(row);
    return result;
}

function clean(t) {
    return t.replace(/\r/g, '').trim();
}

function applySearch() {
    const q = document.getElementById('search').value.toLowerCase();
    currentPage = 1;

    if (q === '') {
        filteredRows = rows;
    } else {
        filteredRows = rows.filter(r =>
            clean(r[0]).toLowerCase().indexOf(q) !== -1
        );
    }
    render();
}

function render() {
    const start = (currentPage - 1) * perPage;
    const end = start + perPage;
    const slice = filteredRows.slice(start, end);
    const tbody = document.getElementById('data');
    tbody.innerHTML = '';

    slice.forEach(r => {
        const nama   = clean(r[0]);
        const ukuran = clean(r[1]);
        const lokasi = clean(r[2]);

        const tr = document.createElement('tr');
        tr.innerHTML =
            '<td>' + nama + '</td>' +
            '<td>' + ukuran + '</td>' +
            '<td><a href="' + encodeURI(lokasi) + '">Download</a></td>';

        tbody.appendChild(tr);
    });

    renderPagination();
}

function renderPagination() {
    const pageCount = Math.ceil(filteredRows.length / perPage);
    const p = document.getElementById('pagination');
    p.innerHTML = '';

    if (pageCount <= 1) return;

    // Prev
    if (currentPage > 1) {
        const prev = document.createElement('a');
        prev.href = '#';
        prev.innerText = 'Prev';
        prev.onclick = function () { currentPage--; render(); return false; };
        p.appendChild(prev);
    }

    // Range halaman dinamis
    const maxPagesToShow = 10;
    let startPage = Math.max(1, currentPage - Math.floor(maxPagesToShow / 2));
    let endPage = Math.min(pageCount, startPage + maxPagesToShow - 1);
    startPage = Math.max(1, endPage - maxPagesToShow + 1);

    if (startPage > 1) {
        const dots = document.createTextNode('... ');
        p.appendChild(dots);
    }

    for (let i = startPage; i <= endPage; i++) {
        const link = document.createElement('a');
        link.href = '#';

        if (i === currentPage) {
            link.innerHTML = '<b>' + i + '</b>';
        } else {
            link.innerText = i;
        }

        link.onclick = function () { currentPage = i; render(); return false; };
        p.appendChild(link);
        p.appendChild(document.createTextNode(' '));
    }

    if (endPage < pageCount) {
        const dots = document.createTextNode(' ...');
        p.appendChild(dots);
    }

    // Next
    if (currentPage < pageCount) {
        const next = document.createElement('a');
        next.href = '#';
        next.innerText = 'Next';
        next.onclick = function () { currentPage++; render(); return false; };
        p.appendChild(next);
    }
}

// Load CSV
fetch('data.csv')
.then(r => r.text())
.then(text => {
    rows = parseCSV(text).slice(1); // buang header
    filteredRows = rows;
    render();
});
</script>

</body>
</html>
